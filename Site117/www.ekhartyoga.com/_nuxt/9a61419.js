(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{51:function(e,t,n){"use strict";n.d(t,"h",(function(){return r})),n.d(t,"g",(function(){return o})),n.d(t,"f",(function(){return c})),n.d(t,"e",(function(){return h})),n.d(t,"j",(function(){return l})),n.d(t,"c",(function(){return f})),n.d(t,"i",(function(){return k})),n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return v})),n.d(t,"d",(function(){return _}));n(32),n(38),n(82),n(60),n(88),n(36),n(14),n(224),n(135),n(41),n(18),n(73);var r=function(e){return null==e},o=function(e){return!r(e)},c=function(a,b){return a.split("?")[0].replace(/\/+$/,"")===b.split("?")[0].replace(/\/+$/,"")},h=function(u){return u&&u.length&&/^\/([a-zA-Z0-9@\-%_~][/a-zA-Z0-9@\-%_~]*)?([?][^#]*)?(#[^#]*)?$/.test(u)},l=function(e,t,n){return e.matched.some((function(e){return Object.values(e.components).some((function(component){return component.options&&component.options[t]===n}))}))},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return[].concat.apply([],e.matched.map((function(e,n){return Object.keys(e.components).map((function(r){return t&&t.push(n),e.components[r]}))})))};function k(){var path=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=path.split("?")[0];return"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e}function d(e){return"string"==typeof e?e:JSON.stringify(e)}function v(e){if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e}function _(e,t){if(!t||!e)return e;if(t in e)return e[t];for(var n=Array.isArray(t)?t:(t+"").split("."),r=e;n.length&&r;)r=r[n.shift()];return r}},622:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n(11),o=n(17),c=(n(14),n(41),n(4)),h=n.n(c),l=n(268),f=n(51),k=function(){function e(t,n){Object(r.a)(this,e),this.ctx=t,this.options=n,this._initState()}return Object(o.a)(e,[{key:"setUniversal",value:function(e,t){return Object(f.h)(t)?this.removeUniversal(e):(this.setState(e,t),this.setCookie(e,t),this.setLocalStorage(e,t),t)}},{key:"getUniversal",value:function(e){var t=this.getState(e);return Object(f.h)(t)&&(t=this.getCookie(e)),Object(f.h)(t)&&(t=this.getLocalStorage(e)),t}},{key:"syncUniversal",value:function(e,t){var n=this.getUniversal(e);return Object(f.h)(n)&&Object(f.g)(t)&&(n=t),Object(f.g)(n)&&this.setUniversal(e,n),n}},{key:"removeUniversal",value:function(e){this.removeState(e),this.removeLocalStorage(e),this.removeCookie(e)}},{key:"_initState",value:function(){var e=this;if(h.a.set(this,"_state",{}),this._useVuex=this.options.vuex&&this.ctx.store,this._useVuex){var t={namespaced:!0,state:function(){return e.options.initialState},mutations:{SET:function(e,t){h.a.set(e,t.key,t.value)}}};this.ctx.store.registerModule(this.options.vuex.namespace,t,{preserveState:Boolean(this.ctx.store.state[this.options.vuex.namespace])}),this.state=this.ctx.store.state[this.options.vuex.namespace]}else h.a.set(this,"state",{})}},{key:"setState",value:function(e,t){return"_"===e[0]?h.a.set(this._state,e,t):this._useVuex?this.ctx.store.commit(this.options.vuex.namespace+"/SET",{key:e,value:t}):h.a.set(this.state,e,t),t}},{key:"getState",value:function(e){return"_"!==e[0]?this.state[e]:this._state[e]}},{key:"watchState",value:function(e,t){var n=this;if(this._useVuex)return this.ctx.store.watch((function(t){return Object(f.d)(t[n.options.vuex.namespace],e)}),t)}},{key:"removeState",value:function(e){this.setState(e,void 0)}},{key:"setLocalStorage",value:function(e,t){if(Object(f.h)(t))return this.removeLocalStorage(e);if("undefined"!=typeof localStorage&&this.options.localStorage){var n=this.options.localStorage.prefix+e;try{localStorage.setItem(n,Object(f.b)(t))}catch(e){if(!this.options.ignoreExceptions)throw e}return t}}},{key:"getLocalStorage",value:function(e){if("undefined"!=typeof localStorage&&this.options.localStorage){var t=this.options.localStorage.prefix+e,n=localStorage.getItem(t);return Object(f.a)(n)}}},{key:"removeLocalStorage",value:function(e){if("undefined"!=typeof localStorage&&this.options.localStorage){var t=this.options.localStorage.prefix+e;localStorage.removeItem(t)}}},{key:"getCookies",value:function(){var e=document.cookie;return Object(l.parse)(e||"")||{}}},{key:"setCookie",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.options.cookie){var r=this.options.cookie.prefix+e,o=Object.assign({},this.options.cookie.options,n),c=Object(f.b)(t);Object(f.h)(t)&&(o.maxAge=-1),"number"==typeof o.expires&&(o.expires=new Date(1*new Date+864e5*o.expires));var h=Object(l.serialize)(r,c,o);return document.cookie=h,t}}},{key:"getCookie",value:function(e){if(this.options.cookie){var t=this.options.cookie.prefix+e,n=this.getCookies(),r=n[t]?decodeURIComponent(n[t]):void 0;return Object(f.a)(r)}}},{key:"removeCookie",value:function(e,t){this.setCookie(e,void 0,t)}}]),e}()},623:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(8),o=n(11),c=n(17),h=(n(37),n(49),n(40),function(){function e(t,n){Object(o.a)(this,e),this.$auth=t,this.name=n._name,this.options=Object.assign({},l,n)}var t,n,h,f,k;return Object(c.a)(e,[{key:"_setToken",value:function(e){this.options.globalToken&&this.$auth.ctx.app.$axios.setHeader(this.options.tokenName,e)}},{key:"_clearToken",value:function(){this.options.globalToken&&this.$auth.ctx.app.$axios.setHeader(this.options.tokenName,!1)}},{key:"mounted",value:function(){if(this.options.tokenRequired){var e=this.$auth.syncToken(this.name);this._setToken(e)}return this.$auth.fetchUserOnce()}},{key:"login",value:(k=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.endpoints.login){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.$auth.reset();case 4:return e.next=6,this.$auth.request(t,this.options.endpoints.login,!0);case 6:if(n=e.sent,r=n.response,o=n.result,this.options.tokenRequired&&(c=this.options.tokenType?this.options.tokenType+" "+o:o,this.$auth.setToken(this.name,c),this._setToken(c)),!this.options.autoFetchUser){e.next=13;break}return e.next=13,this.fetchUser();case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"setUserToken",value:(f=Object(r.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.options.tokenType?this.options.tokenType+" "+t:t,this.$auth.setToken(this.name,n),this._setToken(n),e.abrupt("return",this.fetchUser());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"fetchUser",value:(h=Object(r.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.options.tokenRequired||this.$auth.getToken(this.name)){e.next=2;break}return e.abrupt("return");case 2:if(this.options.endpoints.user){e.next=5;break}return this.$auth.setUser({}),e.abrupt("return");case 5:return e.next=7,this.$auth.requestWith(this.name,t,this.options.endpoints.user);case 7:n=e.sent,this.$auth.setUser(n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"logout",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.options.endpoints.logout){e.next=3;break}return e.next=3,this.$auth.requestWith(this.name,t,this.options.endpoints.logout).catch((function(){}));case 3:return e.abrupt("return",this.$auth.reset());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"reset",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.options.tokenRequired&&this._clearToken(),this.$auth.setUser(!1),this.$auth.setToken(this.name,!1),this.$auth.setRefreshToken(this.name,!1),e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}()),l={tokenRequired:!0,tokenType:"Bearer",globalToken:!0,tokenName:"Authorization",autoFetchUser:!0}},624:function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));n(18),n(16),n(14),n(22),n(15),n(23);var r=n(8),o=n(0),c=n(11),h=n(17),l=(n(37),n(49),n(88),n(38),n(82),n(40),n(127),n(60),n(43),n(45),n(909),n(159)),f=n(384),k=n(9),d=n(226);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function _(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var m=n(910),y={token_type:"Bearer",response_type:"token",tokenName:"Authorization",token_key:"access_token",refresh_token_key:"refresh_token"},$="PKCI_verifier",x="id_token",O="pub_usr_data",j="identity_access_token",U="identity_id_token",S=function(){function e(t,n){Object(c.a)(this,e),this.$auth=t,this.req=t.ctx.req,this.name=n._name,this.config=t.ctx.$config,this.options=_(_(_({},y),n),t.ctx.$config.oauthStrategyOptions)}var t,n,o;return Object(h.a)(e,[{key:"_scope",get:function(){return Array.isArray(this.options.scope)?this.options.scope.join(" "):this.options.scope}},{key:"_redirectURI",get:function(){var e=this.options.redirect_uri;return e||window.location.origin+this.$auth.options.redirect.callback}},{key:"mounted",value:(o=Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.$auth.syncToken(this.name))&&this._setToken(t),e.next=4,this._handleCallback();case 4:if(e.sent){e.next=7;break}return e.abrupt("return",this.$auth.fetchUserOnce());case 7:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_setToken",value:function(e){this.$auth.ctx.app.$axios.setHeader(this.options.tokenName,e)}},{key:"_clearToken",value:function(){this.$auth.ctx.app.$axios.setHeader(this.options.tokenName,!1)}},{key:"_base64URLEncode",value:function(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}},{key:"_sha256",value:function(e){return m.createHash("sha256").update(e).digest()}},{key:"_createDataForPKCE",value:function(){var e=this._base64URLEncode(m.randomBytes(32));return{code_challenge:this._base64URLEncode(this._sha256(e)),code_challenge_method:"S256",verifier:e}}},{key:"_decodeJwt",value:function(e){try{var t=e.split(".")[1],n=atob(t);return JSON.parse(n)}catch(e){console.error("An error occurred while decoding token",e)}}},{key:"reset",value:function(){return this._clearToken(),this.$auth.setUser(!1),this.$auth.setToken(this.name,!1),this.$auth.setRefreshToken(this.name,!1),this.$auth.$storage.removeUniversal($),this.$auth.$storage.removeUniversal(x),this.$auth.$storage.removeUniversal(j),this.$auth.$storage.removeUniversal(U),this.$auth.$storage.removeUniversal(O),this.$auth.$storage.removeUniversal(d.a.POST_AUTH_REDIRECT_URL),Promise.resolve()}},{key:"login",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.params,n=e.state,r=e.nonce,o=_({response_type:this.options.response_type,access_type:this.options.access_type,client_id:this.options.client_id,redirect_uri:this._redirectURI,scope:this._scope,state:n||Object(f.a)()},t);this.options.audience&&(o.audience=this.options.audience),o.response_type.includes("id_token")&&(o.nonce=r||Object(f.a)()),this.$auth.$storage.setUniversal(this.name+".state",o.state),o.nonce="123456";var c=this._createDataForPKCE();o.code_challenge=c.code_challenge,o.code_challenge_method=c.code_challenge_method,this.$auth.$storage.setUniversal($,c.verifier);var h=this.options.authorization_endpoint+"?"+Object(l.a)(o);return window.location=h,h}},{key:"logout",value:function(e){var t=this.$auth.$storage.getUniversal(U),n=this.options.logout_endpoint+"?"+Object(l.a)({id_token_hint:t,post_logout_redirect_uri:this.options.redirect_uri});return this.reset(),n}},{key:"fetchUser",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.$auth.getToken(this.name)){e.next=3;break}return e.abrupt("return");case 3:if(this.options.userinfo_endpoint){e.next=6;break}return this.$auth.setUser({}),e.abrupt("return");case 6:return(n=this._decodeJwt(t))&&n.sub||console.error("User reference not defined in token"),e.next=10,this.$auth.requestWith(this.name,{url:this.options.userinfo_endpoint}).catch((function(e){console.error("Failed to fetch user info!",e)}));case 10:if((r=e.sent)&&r.result){e.next=14;break}return this.$auth.setUser({id_ref:n.sub}),e.abrupt("return");case 14:o=r.result,c={name:"",email:"",profile_image:"",is_default_profile_image:!0,id:0},null!=o&&o.media&&(c.profile_image=Object(k.g)(o.media,{removeMediaStyles:!0,imageWidth:256})),o&&(c.name=o.name,c.email=o.emailAddress,c.id=o.id),this.$auth.$storage.setCookie(O,c,{SameSite:"None",Secure:!1,expires:30}),this.$auth.setUser(r.result);case 20:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_handleCallback",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,o,c,h,f,k,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.$auth.options.redirect||Object(l.b)(this.$auth.ctx.route.path)===Object(l.b)(this.$auth.options.redirect.callback)){e.next=2;break}return e.abrupt("return");case 2:e.next=4;break;case 4:if(n=Object(l.c)(this.$auth.ctx.route.hash.substr(1)),r=Object.assign({},this.$auth.ctx.route.query,n),o=r[this.options.token_key],c=r.id_token,h=r[this.options.refresh_token_key],f=this.$auth.$storage.getUniversal(this.name+".state"),this.$auth.$storage.setUniversal(this.name+".state",null),!f||r.state===f){e.next=13;break}return e.abrupt("return");case 13:if("code"!==this.options.response_type||!r.code){e.next=23;break}if(k=this.$auth.$storage.getUniversal($)){e.next=17;break}throw new Error("PKCI_VERIFIER is undefined.");case 17:return e.next=19,this.$auth.request({method:"post",url:this.options.access_token_endpoint,baseURL:!1,data:Object(l.a)(_(_({code:r.code,client_id:this.options.client_id,redirect_uri:this._redirectURI,return_url:t},this.options.client_secret&&{client_secret:this.options.client_secret}),{},{response_type:this.options.response_type,audience:this.options.audience,grant_type:this.options.grant_type,code_verifier:k}))});case 19:(data=e.sent)[this.options.token_key]&&(o=data[this.options.token_key]),data.id_token&&(c=data.id_token),data[this.options.refresh_token_key]&&(h=data[this.options.refresh_token_key]);case 23:if(o&&o.length){e.next=25;break}return e.abrupt("return");case 25:return this.$auth.$storage.setUniversal(j,o),this.$auth.$storage.setUniversal(U,c),this.options.token_type&&(o=this.options.token_type+" "+o),this.$auth.setToken(this.name,o),this._setToken(o),h&&h.length&&(h=this.options.token_type+" "+h,this.$auth.setRefreshToken(this.name,h)),this.$auth.redirect("home",!0),e.abrupt("return",!0);case 33:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}()}}]);